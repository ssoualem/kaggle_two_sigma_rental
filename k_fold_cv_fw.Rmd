---
title: "K-fold cross-validation framework"
author: "Samy Soualem"
date: "March 13, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Global parameters and ML libraries
```{r}
# Don't use all data first to speed up development
SAMPLE_TRAIN <- TRUE
TRAIN_SIZE <- 50

K <- 10
CV_REPEAT <- 3


library(dplyr)
library(caret)
library(randomForest)
library(doMC)

source("processing/fct_train.R")



init_train()


```



# TODO : check 0 or near 0 variance
```{r}

```

# TODO : check correlated predictors
```{r}

```


# Feature subset and pre-processing
```{r}
if(SAMPLE_TRAIN) {
  train_data <- sample_n(clean_data, TRAIN_SIZE)
} else {
  train_data <- clean_data
}


# Feature selection
train_data <- get_feature_subset(train_data)


test_tmp_model <- train_rf_0(train_data, K, CV_REPEAT, "test_tmp")

test_tmp_model$results$logLoss

summary(test_tmp_model)
```



# Temp prediction code
```{r}
# Load test set
raw_test_data <- load_data(file.path(DATA_DIR, "test.json"))

clean_test_data <- transform_raw_data(raw_test_data, "test")

test_pred <- predict(rf_fit_0, newdata = clean_test_data, type = "prob")

head(test_pred)

write_submission(clean_test_data, test_pred, "rf_fit_0")
```


